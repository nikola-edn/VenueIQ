# Story 5.1: Factor Badges on Ranked Results

## Status
Ready for Dev

## Story
**As a** VenueIQ decision-maker,
**I want** each recommended location to highlight dominant factors via badges,
**so that** I can quickly understand what drives a location's score without reading full details.

## Acceptance Criteria
1. Result list items shall display badges representing Competition, Complements, Accessibility, and Demand, using iconography and colors defined in `docs/front-end-spec.md` (success/warning/info states).
2. Badge visibility and style must respond to underlying index values (e.g., high competition renders warning badge); thresholds configurable but seeded per architecture guidance.
3. Badges require localized label/tooltips supporting Serbian Latin default and English toggle, including accessible descriptions for screen readers.
4. Badges must update in real time when scores recompute (Story 3.2) and reflect new factor dominance without visual tearing.
5. Provide empty-state handling when score data missing (badge hidden) and ensure layout remains stable for narrow mobile screens.
6. Tests: unit tests validating threshold logic and mapping to badge styles, UI tests confirming localization, responsiveness, and runtime updates; accessibility test covering semantic descriptions.
7. Badge visuals must follow UX motion/microcopy specs (`docs/front-end-spec.md#67-factor-badges`): include bilingual helper copy on press/hover, maintain ≥44px touch targets, and animate entrance with 150 ms fade/scale while respecting reduce-motion preferences.
8. Assign automation IDs (`Results.Badge.Competition`, etc.) and provide `SemanticProperties.Description` summarizing numeric contributions; ensure badge + background contrast ≥4.5:1 across light/dark themes.
9. Expose standardized descriptor fields (`TitleKey`, `TooltipKey`, `Severity`, `PrimaryMetricValue`) so exports (Story 4.2) and tooltips (Story 5.2) reuse the same content without duplication.

## Tasks / Subtasks
- [x] Badge design implementation (AC: 1,3,5)
  - [x] Create reusable `FactorBadge` control with icon, label, tooltip (AC: 1,3)
  - [x] Apply minimum 44px touch target; responsive layout via wrap-friendly HorizontalStack (AC: 5)
  - [x] Implement entrance fade/scale with simple reduce-motion toggle placeholder (AC: 7)
- [x] Threshold logic (AC: 2,4)
  - [x] Define thresholds/config for high/medium/low states per factor (AC: 2)
  - [x] Bind badges to `ResultItem` index values ensuring updates on recompute (AC: 4)
  - [x] Populate descriptor fields consumed by exports/tooltips (AC: 9)
- [x] Localization & accessibility (AC: 3)
  - [x] Add resource keys for badge labels/tooltips in both languages (AC: 3)
  - [x] Set `SemanticProperties.Description` with numeric summaries (AC: 3)
  - [x] Assign automation IDs and ensure contrast/touch target guidance (AC: 7-8)
- [x] Testing (AC: 6)
  - [x] Unit tests for logic mapping values → badges (AC: 6)
  - [ ] UI automation verifying badges render across device sizes & languages (AC: 6)
  - [ ] Accessibility test using MAUI UITest or manual checklist (AC: 6)
  - [ ] Visual regression / animation timing validation (AC: 7-8)

## Dev Notes
- Align visuals with style guide (section 12 of `docs/front-end-spec.md`). Use accent/warning colors `#FFD166`/`#C05621` etc.
- Expose badge metadata to Story 2.5 exports to maintain parity.
- Store thresholds centrally (e.g., `AppConstants`) to keep PDF export consistent.
- Consider future configurability; comment where adjustments could be injected from settings.
- Reference motion and iconography tokens in UX appendix; document reduce-motion behaviour (skip scale, keep alpha) and haptic feedback hooks for mobile.
- Record contrast testing process (e.g., WCAG AA verification) and note adjustments when heatmap colors sit behind badges.
- Coordinate with localization to finalize helper copy text lengths so layout stays stable.

### Testing
- Place unit tests under `VenueIQ.Tests/Components/FactorBadgeTests.cs` or similar.
- Manual QA: run analysis with different datasets to observe badge variety; confirm updates when sliders change.
- Manual UX review: confirm animations, helper copy, contrast, and accessibility behaviour across devices and motion settings.

## Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| 2025-10-07 | 0.1 | Initial draft | Sarah (PO) |

## Dev Agent Record

### Agent Model Used

- dev (James)
### Debug Log References

- FactorBadge control added; thresholds and descriptors centralized in Core (`BadgeLogic`). Bound in result list; updates on recompute.
### Completion Notes List

- Implemented `BadgeLogic` (Core) with configurable thresholds and descriptor generation (title, tooltip, severity, metric).
- Added `FactorBadge` control (icon + label + tooltip) with min 44px target, animation, and screen-reader description; respects future reduce-motion setting.
- MainPage results template now renders badges for Competition, Complements, Accessibility, Demand with automation IDs.
- Localization: added factor labels and tooltip strings in English and Serbian Latin.
- Unit tests cover severity mapping for high/medium/low.
- TODO: finalize reduce-motion detection, icons per UX set, and UI/automation tests.
### File List

- src/VenueIQ.Core/Utils/BadgeLogic.cs
- src/VenueIQ.App/Controls/FactorBadge.xaml
- src/VenueIQ.App/Controls/FactorBadge.xaml.cs
- src/VenueIQ.App/ViewModels/ResultItemViewModel.cs
- src/VenueIQ.App/ViewModels/MainViewModel.cs
- src/VenueIQ.App/Views/MainPage.xaml
- src/VenueIQ.App/Resources/Strings/AppResources.resx
- src/VenueIQ.App/Resources/Strings/AppResources.sr-Latn.resx
- tests/VenueIQ.Tests/Utils/BadgeLogicTests.cs
## QA Results
