# Story 5.2: Result Detail Tooltips with Distances

## Status
Ready for Dev

## Story
**As a** VenueIQ analyst,
**I want** to view detailed tooltips for each recommended location showing nearby POIs and distances,
**so that** I can justify why a location ranks highly or poorly.

## Acceptance Criteria
1. Selecting or hovering a result (depending on platform interaction model) must display a detail tooltip/panel containing top competitors and complements with their names, categories, and distance in meters.
2. Tooltip content shall also include quick metrics (e.g., nearest transit distance, demand index explanation) using localized strings and units.
3. Tooltips must appear within 150 ms of selection, positioned contextually near the result card on desktop and as expandable panel on mobile per UX spec.
4. Accessibility: tooltips must be reachable via keyboard focus, provide dismiss controls, and expose content through screen reader description.
5. Update tooltip content in sync with recompute results; if data unavailable, display meaningful fallback messaging rather than stale info.
6. Tests: unit tests for tooltip data formatting and distance conversions, UI automation verifying tooltip visibility timing and platform-specific rendering, accessibility test ensuring focus order and announcements.
7. Tooltip visuals/behaviours must align with `docs/front-end-spec.md#52-result-detail-tooltips`: include bilingual heading, factor badges summary, and CTA links (e.g., "Open in Maps") while ensuring 200 ms fade/slide animation and reduce-motion support.
8. Ensure tooltips reuse descriptor data from badges/ScoreCalculator (`PrimaryMetricValue`, `CoverageConfidence`) and expose automation IDs (`Results.Tooltip.Desktop`, `Results.Tooltip.Mobile`), ARIA roles (`dialog` or `tooltip`), and polite screen reader announcements.
9. Implement safe positioning with collision detection to avoid clipping on small screens; provide scrollable content area when POI lists exceed viewport, keeping close button persistently accessible.

## Tasks / Subtasks
- [ ] UI component implementation (AC: 1-4)
  - [ ] Build tooltip/expander control with responsive behavior (desktop hover vs mobile expand) (AC: 1,3)
  - [ ] Integrate with result selection events, ensuring keyboard support (AC: 4)
  - [ ] Apply UX-specified animations, reduce-motion fallback, and CTA layout (AC: 7-9)
- [ ] Data-binding logic (AC: 1-5)
  - [ ] Extend `ResultItem` to expose POI summaries and metrics (AC: 1-2)
  - [ ] Format distance text using localized units and rounding (AC: 2)
  - [ ] Refresh content when recompute completes (AC: 5)
  - [ ] Pull descriptor data from badge metadata to avoid duplication (AC: 8)
- [ ] Accessibility & localization (AC: 2,4)
  - [ ] Add resource keys for tooltip headings/descriptions (AC: 2)
  - [ ] Provide focus management and dismiss actions (AC: 4)
  - [ ] Assign automation IDs, ARIA roles, and ensure scrollable content meets accessibility guidelines (AC: 8-9)
- [ ] Testing (AC: 6)
  - [ ] Unit tests for formatting logic (AC: 6)
  - [ ] UI tests verifying tooltip appears on selection/hover and hides appropriately (AC: 6)
  - [ ] Accessibility validation (screen reader, keyboard navigation) (AC: 6)
  - [ ] Visual regression + positioning tests to ensure collision handling on various screen sizes (AC: 7-9)

## Dev Notes
- UX guidance located in `docs/front-end-spec.md` sections 5.2 and 7; ensure mobile vs desktop behavior matches specification.
- Use `Popup` or custom overlay component for desktop; on mobile, reuse detail pane pattern defined for results.
- Distances should use `LocalizationService` for decimal separators and unit translations.
- Provide extension points for future analytics (e.g., how often tooltips viewed).
- Document CTA copy, icon usage, and link behaviour (e.g., deep link to navigation app) per UX/PM input.
- Coordinate with localization for length of descriptions to prevent overflow; consider multi-line truncation with "view more" if needed.
- Note behaviour when results list is virtualized (ensure tooltip attaches to visible item even after scroll).

### Testing
- Place tests alongside result list tests from Story 2.5 to reuse fixtures.
- Manual QA: verify tooltip positioning on multiple screen sizes, ensure content updates when weights change.
- Manual UX sweep: validate animations, CTA actions, accessibility behaviours, and reduce-motion fallback on desktop + mobile.

## Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| 2025-10-07 | 0.1 | Initial draft | Sarah (PO) |

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results
