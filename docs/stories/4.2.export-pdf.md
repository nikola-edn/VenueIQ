# Story 4.2: Export Results List as PDF Report

## Status
Ready for Dev

## Story
**As a** VenueIQ analyst preparing client deliverables,
**I want** to export the ranked results and supporting rationale as a PDF report,
**so that** I can share a polished summary of recommended locations.

## Acceptance Criteria
1. Export dialog shall allow selecting language (Serbian Latin default, English optional), page orientation, and inclusion options (map thumbnails, POI tables, methodology section).
2. Generated PDF must contain: cover page with analysis metadata, ranked list with scores and rationale badges, mini map preview for each location, summarized top POIs, and weight configuration snapshot.
3. Export workflow must use QuestPDF or Syncfusion (per architecture) with templates localized via RESX strings; ensure fonts support Serbian Latin characters.
4. Handle large result sets by limiting to top 10 by default, with option to expand (warn about length). Provide pagination and consistent styling per design system.
5. Exports run asynchronously with progress indicator, saving to user-selected location; on success/failure, show localized message and log outcome.
6. Tests: unit tests for template generation and localization, integration tests verifying PDF structure/content via snapshot comparison, UI tests covering dialog flow and error handling.
7. PDF layout must mirror UX spec (`docs/front-end-spec.md#64-export-dialogs` + report template appendix): bilingual copy decks, branded color palette, accessible contrast, and tagged PDF elements to aid screen readers where possible.
8. Include optional executive summary section (toggle) and ensure methodology wording aligns with UX-approved copy; provide placeholders for future appendix (market data) while keeping structure modular.
9. Export dialog and generated report must expose automation IDs, focus order, and reduce-motion-aware progress indicator; screen reader announcements should cover start/completion, errors, and large-report warnings.

## Tasks / Subtasks
- [ ] Export dialog & options (AC: 1,4-5)
  - [ ] Create modal for PDF export settings (language, orientation, content toggles) (AC: 1)
  - [ ] Display warnings for large result sets (AC: 4)
  - [ ] Implement UX-defined focus order, automation IDs, and bilingual helper text (AC: 7,9)
- [ ] Template design (AC: 2-4)
  - [ ] Build PDF template with cover, ranked list, map thumbnails, POI tables, methodology (AC: 2)
  - [ ] Ensure localization via RESX and proper font embedding (AC: 3)
  - [ ] Implement pagination and consistent styling per brand (AC: 4)
  - [ ] Add executive summary toggle and modular appendix placeholders (AC: 8)
  - [ ] Apply tagged-PDF semantics if supported (headings, tables) for accessibility (AC: 7)
- [ ] Map thumbnail integration (AC: 2)
  - [ ] Reuse heatmap export pipeline for per-result snapshots or static map API fallback (AC: 2)
  - [ ] Cache thumbnails during export to avoid repeated rendering (AC: 2)
- [ ] ExportService implementation (AC: 2-5)
  - [ ] Assemble data DTO for template (scores, POIs, weights) (AC: 2)
  - [ ] Run export async with progress reporting, handle errors (AC: 5)
  - [ ] Announce progress via accessible status messages and honor reduce-motion preference (AC: 9)
- [ ] Testing (AC: 6)
  - [ ] Unit tests verifying template sections populate correctly (AC: 6)
  - [ ] Integration test generating sample PDF and comparing against golden file (AC: 6)
  - [ ] UI automation ensuring dialog flow, language toggle, progress indicator (AC: 6)
  - [ ] Snapshot/comparison of PDF visual elements vs UX reference (AC: 7-8)
  - [ ] Accessibility tests checking focus order, announcements, and tagged PDF content (AC: 7,9)

## Dev Notes
- Architecture guidance for ExportService in `docs/architecture/6-components.md`; align with UI spec `docs/front-end-spec.md` section 6.4 and localization requirements in Story 1.4.
- Ensure fonts (e.g., Montserrat, Source Sans Pro) embedded in PDF with proper licensing; fallback to system fonts if necessary.
- For map previews, consider using static map API to avoid heavy WebView render loops during export; document trade-offs.
- Provide configuration for default output path and remember last selection if feasible (persisted via SettingsService).
- Include notes about testing exports in CI (disable actual file writes or use temp directories).
- Reference copy deck from UX/PM for executive summary, methodology, and appendix sections; keep copy IDs consistent with localization resources.
- Validate color palette/contrast in PDF (especially on print) and document ICC profile usage if required.
- Capture known limitations (e.g., tagged PDF support level) for QA sign-off and future improvements.

### Testing
- Reference `docs/architecture/13-test-strategy.md`; use snapshot-based assertions for PDF structure (extract text/metadata for verification).
- Manual QA: generate PDFs in both languages, verify string translations, map thumbnails, formatting, and accessible text tags if supported.
- Manual UX run-through: review dialog, progress indicator, PDF output against design mocks; validate large-report warning, executive summary toggle, and accessibility behaviour.

## Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| 2025-10-07 | 0.1 | Initial draft | Sarah (PO) |

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results
