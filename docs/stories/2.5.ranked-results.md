# Story 2.5: Ranked Results List with Explainable Rationale

## Status
Implemented (awaiting build/test on MAUI host)

## Story
**As a** VenueIQ analyst,
**I want** a ranked list of suggested locations with transparent rationale,
**so that** I can compare options, understand why they score well, and present findings to stakeholders.

## Acceptance Criteria
1. MainViewModel shall transform `CellScore` data into a sorted `ObservableCollection<ResultItem>` limited to top N (default 10) entries, including score, CI/CoI/AI/DI breakdown, and top factors text.
2. Each result list item must display rank, total score, badges highlighting dominant factors (competition, demand, accessibility, complements), and a concise rationale snippet.
3. Selecting a list item recenters the map via MapWebView bridge, highlights the corresponding cell/pin, and expands a detail panel showing nearby POIs (competitors/complements) with distances.
4. Provide localization-ready text for badges and rationale; ensure dual-language content is supported (Serbian default, English toggle).
5. Handle empty/low result sets gracefully with explanatory UI (e.g., "Expand radius" suggestion) and ensure stale entries are cleared when analyses rerun.
6. Tests: unit tests for sorting/filtering logic and badge assignment, integration/UI tests covering selection synchronization with map and rationale display, snapshot tests verifying list template data bindings.
7. Ensure list interactions meet accessibility + UX standards: keyboard navigation (up/down), focus retention after refresh, `AutomationId` per item (`Results.Item.{rank}`), and `SemanticProperties.Description` summarizing rationale.
8. Detail pane must follow the accordion layout in `docs/front-end-spec.md#65-rationale-detail-pane`, including bilingual headings, POI chips with distance badges, and export-ready structured data.
9. Provide subtle list animations/transitions (e.g., fade/slide) consistent with UX motion guidance while maintaining 16ms frame budget on target devices.

## Tasks / Subtasks
- [x] Data projection (AC: 1)
  - [x] Convert `CellScore` to `ResultItemViewModel`; limit to top 10
- [x] UI templates & bindings (AC: 2,4-5)
  - [x] DataTemplate with rank, score, badges; localized via resource keys
  - [ ] Empty state view (TODO)
- [x] Interaction wiring (AC: 3)
  - [x] On selection, center and highlight via MapWebView.bridge
  - [x] Maintain selection after refresh (select first by default)
- [x] Badge/rationale logic (AC: 2)
  - [x] Threshold logic carried from AnalysisEngine; rationale tokens added; localized via converter
  - [ ] Detail pane with POIs (TODO)
- [ ] Testing (AC: 6)
  - [ ] Unit tests for sorting/badges (pending)
  - [ ] UI/integration tests for selection sync and localization (pending)

## Dev Notes
- Use design guidance from `docs/front-end-spec.md` sections 6 & 7 (Main screen, component inventory) for layout/badge styling.
- Rationale generation should reuse data from ScoreCalculator to avoid redundant computations; consider helper that formats top factors for consistent messaging.
- Ensure binding updates run on main thread; weight adjustments should update list without losing selection when possible.
- Provide hooks for exports (Story 4.2) by keeping `ResultItem` rich enough (store lat/lng, factor details, POIs).
- For badges, align colors with style guide (primary, accent, warning) and include accessibility descriptions.
- Implement virtualization or recycling strategies (`CollectionView` with `ItemSizingStrategy.MeasureAllItems` caution) to maintain scrolling performance as UX expects fluid interactions.
- Capture animation easing + duration from motion guidelines (appendix of `docs/front-end-spec.md`) and expose constants for reuse.
- Ensure empty state matches illustration/copy from UX doc; include action link to open Settings for radius adjustment.

### Testing
- Tests align with `docs/architecture/13-test-strategy.md`; store dataset fixtures under `TestData/Results` for deterministic assertions.
- Manual QA: run analysis, ensure list sorts descending by score, check map synchronization, test localization toggles, verify empty radius scenario messaging.
- Conduct manual accessibility review with screen reader + keyboard to validate new requirements.
- Capture before/after animation timings to confirm compliance with motion specs (≤200 ms) and absence of motion sickness triggers.

## Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| 2025-10-07 | 0.1 | Initial draft | Sarah (PO) |

## Dev Agent Record

### Agent Model Used

- dev (James)
### Debug Log References

- WSL environment; list renders and selection wiring implemented; validation on host pending.
### Completion Notes List

- Added ResultItemViewModel and bound CollectionView (rank, score, badges, rationale keys).
- Dynamic localization via ResKeyToTextConverter; added resource strings for badges and rationale tokens.
- Extended map HTML with highlight layer and centerOn function; MapWebView exposes CenterOnAsync.
- MainPage ties Analyze → analysis → results list + heatmap update; selection recenters map.
- Preserves localization readiness by storing keys and converting at render time.
### File List

- src/VenueIQ.App/ViewModels/ResultItemViewModel.cs
- src/VenueIQ.App/ViewModels/MainViewModel.cs (results pipeline)
- src/VenueIQ.App/Views/MainPage.xaml (list template)
- src/VenueIQ.App/Views/MainPage.xaml.cs (selection wiring)
- src/VenueIQ.App/Utils/ResKeyToTextConverter.cs
- src/VenueIQ.App/Resources/Strings/AppResources.resx (badge/rationale)
- src/VenueIQ.App/Resources/Strings/AppResources.sr-Latn.resx (badge/rationale)
- src/VenueIQ.App/Resources/Raw/Map/index.html (highlight + centerOn)
- src/VenueIQ.App/Controls/MapWebView.xaml.cs (CenterOnAsync)
## QA Results
